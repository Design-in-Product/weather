<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Sketch 6 — Rain Rhythm Sparklines</title>
<style>
  :root {
    --bg: #0a0e17;
    --bg-card: #0f1923;
    --text: #c8d6e5;
    --text-bold: #fff;
    --muted: #5f7d9a;
    --dim: #3d566e;
    --border: #1a2332;
    --accent: #34c6c6;
    --accent-light: #6ee7e7;
    --accent-dark: #0e5a6f;
    --tooltip-bg: #1a2332;
    --tooltip-border: #2d4055;
    --shadow: rgba(0,0,0,0.5);
  }
  body.light {
    --bg: #f5f7fa;
    --bg-card: #ffffff;
    --text: #2d3748;
    --text-bold: #1a202c;
    --muted: #64748b;
    --dim: #94a3b8;
    --border: #e2e8f0;
    --accent: #0891b2;
    --accent-light: #06b6d4;
    --accent-dark: #164e63;
    --tooltip-bg: #ffffff;
    --tooltip-border: #e2e8f0;
    --shadow: rgba(0,0,0,0.1);
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'SF Mono', 'Menlo', monospace; background: var(--bg); color: var(--text); padding: 32px; }
  h1 { font-size: 14px; text-transform: uppercase; letter-spacing: 2px; color: var(--muted); margin-bottom: 4px; }
  .subtitle { font-size: 11px; color: var(--dim); margin-bottom: 28px; }
  .row { display: flex; align-items: center; gap: 16px; margin-bottom: 16px; }
  .month-label { width: 80px; font-size: 12px; color: var(--muted); text-align: right; }
  .sparkline { flex: 1; height: 48px; position: relative; cursor: crosshair; }
  .spark-canvas { width: 100%; height: 100%; }
  .month-total { width: 64px; font-size: 13px; font-weight: bold; color: var(--accent); text-align: right; }
  .month-days { width: 50px; font-size: 10px; color: var(--dim); }
  .annotation { margin-top: 24px; padding: 16px; background: var(--bg-card); border-radius: 8px; border: 1px solid var(--border); }
  .annotation h3 { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); margin-bottom: 8px; }
  .annotation p { font-size: 12px; line-height: 1.6; color: #8a9bb5; }
  .annotation strong { color: var(--accent); }
  .tooltip { position: fixed; background: var(--tooltip-bg); border: 1px solid var(--tooltip-border); padding: 6px 10px;
             border-radius: 4px; font-size: 10px; pointer-events: none; z-index: 10; display: none; }
</style>
</head>
<body>
<h1>Rain Rhythm</h1>
<p class="subtitle">Each month's daily rainfall as a sparkline · hover to read individual days</p>
<div id="rows"></div>
<div class="annotation">
  <h3>Reading the rhythm</h3>
  <p>Tall spikes = single heavy storms. Clusters of short bars = lingering fronts. Long flat stretches = the dry spells California is famous for. Notice how <strong>December</strong> was bone-dry for 16 days, then dumped everything in the last 10. <strong>January</strong> opened with a bang then went completely silent for 24 straight days.</p>
</div>
<div class="tooltip" id="tip"></div>
<script>
const DATA = {"2025-10-01":0,"2025-10-02":0.24,"2025-10-03":0,"2025-10-04":0,"2025-10-05":0,"2025-10-06":0,"2025-10-07":0,"2025-10-08":0,"2025-10-09":0,"2025-10-10":0,"2025-10-11":0,"2025-10-12":0,"2025-10-13":0.53,"2025-10-14":0,"2025-10-15":0.01,"2025-10-16":0,"2025-10-17":0,"2025-10-18":0,"2025-10-19":0,"2025-10-20":0,"2025-10-21":0,"2025-10-22":0,"2025-10-23":0,"2025-10-24":0,"2025-10-25":0,"2025-10-26":0.02,"2025-10-27":0.03,"2025-10-28":0,"2025-10-29":0,"2025-10-30":0,"2025-10-31":0,"2025-11-01":0,"2025-11-02":0,"2025-11-03":0,"2025-11-04":0,"2025-11-05":0.11,"2025-11-06":0,"2025-11-07":0,"2025-11-08":0,"2025-11-09":0,"2025-11-10":0,"2025-11-11":0,"2025-11-12":0,"2025-11-13":1.47,"2025-11-14":0,"2025-11-15":0.22,"2025-11-16":0.29,"2025-11-17":0.68,"2025-11-18":0.01,"2025-11-19":0,"2025-11-20":0.24,"2025-11-21":0,"2025-11-22":0,"2025-11-23":0,"2025-11-24":0,"2025-11-25":0,"2025-11-26":0,"2025-11-27":0,"2025-11-28":0,"2025-11-29":0,"2025-11-30":0,"2025-12-01":0,"2025-12-02":0,"2025-12-03":0,"2025-12-04":0,"2025-12-05":0,"2025-12-06":0,"2025-12-07":0,"2025-12-08":0,"2025-12-09":0,"2025-12-10":0,"2025-12-11":0,"2025-12-12":0,"2025-12-13":0,"2025-12-14":0,"2025-12-15":0,"2025-12-16":0,"2025-12-17":0.01,"2025-12-18":0,"2025-12-19":0,"2025-12-20":0,"2025-12-21":0.08,"2025-12-22":0.34,"2025-12-23":0.07,"2025-12-24":1.27,"2025-12-25":0.99,"2025-12-26":0.09,"2025-12-27":0,"2025-12-28":0,"2025-12-29":0,"2025-12-30":0,"2025-12-31":0.79,"2026-01-01":0.63,"2026-01-02":0.11,"2026-01-03":0.10,"2026-01-04":1.22,"2026-01-05":0.85,"2026-01-06":0.02,"2026-01-07":0.03,"2026-01-08":0,"2026-01-09":0,"2026-01-10":0,"2026-01-11":0,"2026-01-12":0,"2026-01-13":0,"2026-01-14":0,"2026-01-15":0,"2026-01-16":0,"2026-01-17":0,"2026-01-18":0,"2026-01-19":0,"2026-01-20":0,"2026-01-21":0,"2026-01-22":0,"2026-01-23":0,"2026-01-24":0,"2026-01-25":0,"2026-01-26":0,"2026-01-27":0,"2026-01-28":0,"2026-01-29":0,"2026-01-30":0,"2026-01-31":0,"2026-02-01":0,"2026-02-02":0,"2026-02-03":0,"2026-02-06":0,"2026-02-07":0,"2026-02-08":0,"2026-02-09":0,"2026-02-10":0.39,"2026-02-11":0.11,"2026-02-12":0,"2026-02-13":0,"2026-02-14":0};

const months = [
  { key: '2025-10', name: 'October', days: 31 },
  { key: '2025-11', name: 'November', days: 30 },
  { key: '2025-12', name: 'December', days: 31 },
  { key: '2026-01', name: 'January', days: 31 },
  { key: '2026-02', name: 'February', days: 14 },
];

const globalMax = Math.max(...Object.values(DATA));
const container = document.getElementById('rows');
const tip = document.getElementById('tip');

const isLight = () => document.body.classList.contains('light');

// Store references for redraw
const canvasData = [];

function buildRows() {
  container.innerHTML = '';
  canvasData.length = 0;

  months.forEach(m => {
    const row = document.createElement('div');
    row.className = 'row';

    // Gather month data
    const vals = [];
    let total = 0, rainDays = 0;
    for (let d = 1; d <= m.days; d++) {
      const key = m.key + '-' + String(d).padStart(2, '0');
      const v = DATA[key] ?? null;
      vals.push({ day: d, key, val: v });
      if (v !== null) { total += v; if (v > 0) rainDays++; }
    }

    const canvas = document.createElement('canvas');
    canvas.className = 'spark-canvas';
    canvas.width = 500;
    canvas.height = 48;

    canvasData.push({ canvas, vals, m });

    // Hover
    const sparkDiv = document.createElement('div');
    sparkDiv.className = 'sparkline';
    sparkDiv.appendChild(canvas);
    sparkDiv.addEventListener('mousemove', e => {
      const rect = sparkDiv.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const dayIdx = Math.floor(x / rect.width * m.days);
      const v = vals[dayIdx];
      if (!v) { tip.style.display = 'none'; return; }
      const mutedColor = isLight() ? '#64748b' : '#5f7d9a';
      const accentColor = isLight() ? '#06b6d4' : '#6ee7e7';
      tip.innerHTML = `<span style="color:${mutedColor}">${v.key}</span> <span style="color:${accentColor};font-weight:bold">${v.val !== null ? v.val.toFixed(2) + '"' : 'N/A'}</span>`;
      tip.style.display = 'block';
      tip.style.left = e.clientX + 12 + 'px';
      tip.style.top = e.clientY - 24 + 'px';
    });
    sparkDiv.addEventListener('mouseleave', () => tip.style.display = 'none');

    const label = document.createElement('div');
    label.className = 'month-label';
    label.textContent = m.name;

    const totalEl = document.createElement('div');
    totalEl.className = 'month-total';
    totalEl.textContent = total.toFixed(2) + '"';

    const daysEl = document.createElement('div');
    daysEl.className = 'month-days';
    daysEl.textContent = rainDays + ' days';

    row.appendChild(label);
    row.appendChild(sparkDiv);
    row.appendChild(totalEl);
    row.appendChild(daysEl);
    container.appendChild(row);
  });
}

function drawCanvases() {
  const gradTop = isLight() ? '#06b6d4' : '#6ee7e7';
  const gradBot = isLight() ? '#b2e2e8' : '#0e5a6f';

  canvasData.forEach(({ canvas, vals, m }) => {
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, 500, 48);
    const barW = (500 / m.days) - 1;
    vals.forEach((v, i) => {
      if (v.val === null || v.val === 0) return;
      const h = (v.val / globalMax) * 40;
      const x = i * (500 / m.days);
      const gradient = ctx.createLinearGradient(0, 48 - h, 0, 48);
      gradient.addColorStop(0, gradTop);
      gradient.addColorStop(1, gradBot);
      ctx.fillStyle = gradient;
      ctx.fillRect(x, 48 - h, Math.max(barW, 2), h);
    });
  });
}

function renderAll() {
  buildRows();
  drawCanvases();
}

renderAll();
</script>
<button id="themeToggle" style="position:fixed;top:12px;right:12px;background:var(--bg-card);border:1px solid var(--border);color:var(--muted);padding:4px 10px;border-radius:4px;font:10px/1 monospace;cursor:pointer;z-index:100">Light</button>
<script>
(function(){
  const btn = document.getElementById('themeToggle');
  if(new URLSearchParams(location.search).has('light')){document.body.classList.add('light');btn.textContent='Dark'}
  btn.addEventListener('click', () => {
    document.body.classList.toggle('light');
    btn.textContent = document.body.classList.contains('light') ? 'Dark' : 'Light';
    renderAll();
  });
  // Re-render if started in light mode
  if(document.body.classList.contains('light')) renderAll();
})();
</script>
</body>
</html>
